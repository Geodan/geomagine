<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="./gm-cow-core.html">
<link rel="import" href="./app-instance.html">
<link rel="import" href="./score-card.html">

<script src="../cowconfigs.js"></script>
<dom-module id="main-monitor">
    <template>
		<style is="custom-style" include="iron-flex iron-flex-alignment">
		</style>
        <gm-cow-core id="cowcore" config="[[cowconfig]]" core="{{_cow}}"></gm-cow-core>
        <app-instance
			id="maininstance"
			cow="[[_cow]]"
			team="xx"
			scenario="xx"
			projectname="{{projectname}}"
			type="monitor"
			teams="{{teams}}"
			scenarios="{{scenarios}}"
			project_ready="{{project_ready}}"
        ></app-instance>
        
        <paper-dialog modal opened='[[waiting]]'>
		  <h2>Paused</h2>
		  <div>
		  <paper-spinner alt="Loading contacts list" active></paper-spinner>
		  Project is not (completely) loaded...
		  </div>
		</paper-dialog>
		
		<h1>Monitor</h1>
        <h4>Project: [[projectname]]</h4>
        
        <div id="cards" class="layout horizontal wrap">
			<template is="dom-repeat" items="[[teams]]" as="team" sort="_sortByTitle">
				<template is="dom-repeat" items="[[scenarios]]" as="scenario" sort="_sortByTitle">
					<score-card
						team="[[team._data.name]]"
						scenario="[[scenario._data.name]]"
						cow="[[_cow]]"
						></score-card>
				</template>
				<br>
			</template>
        </div>
    </template>
</dom-module>
<script>

Polymer({
	is: 'main-monitor',
	properties: {
		project_ready: {
			type: Object,
			observer: '_waitForProject'
		},
		scenarios: {
			type: Array,
		},
		teams: {
			type: Array,
		},
		scenario: String,
		team: String,
		waiting: {
			type: Boolean,
			value: true
		}
	},
	
	_waitForProject: function() {
		var self =this;
		this.waiting = true;
		this.entities = [];
		if (this.project_ready) {
			this.project_ready.then(function(){
				console.log('project ready');
				self.waiting = false;
				//self.projectcreated = new Date(self.project.created()).toISOString();
			});
		}
	},
	ready: function() {
		this.cowconfig = window.cowconfig;
		//this.$.instance.addEventListener('projectclosed',function(){
		//	self._waitForProject();
		//});
	},
	attached: function () {
		//this.instanceReady.then(function(){
		//    console.log('instance is ready');
		//});
	},
	_sortByTitle: function(a,b){
        	if (a.data('title') < b.data('title')){
        		return -1;
        	} else if (a.data('title') > b.data('title')){
        		return 1;
        	} else {
        		return 0;
        	}
    },
});

</script>